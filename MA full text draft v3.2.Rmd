---
title: "The Moderating Effects of the Need for Multinational Investment on State Repression"
author: "Steven Saroka"
date: "5/17/2020"
output: pdf_document
fig_crop: no
header-includes:
   - \usepackage{indentfirst}
   - \usepackage{url} 
   - \usepackage{hyperref}
   - \setlength\parindent{24pt}
   - \usepackage{tikz}
   - \usetikzlibrary{calc}
   - \usepackage{setspace}\doublespacing
abstract: "What are the effects of resource endowments on state repression? This paper theorizes that states are more likely to engage in repression to secure resource-rich areas to maximize the state’s profits, with repression intensity varying by whether the resource requires outside investment to extract. Should resource extraction require outside investment, states must restrain their repression and share profits with an external multinational corporation. This theory yields predictions that there will be higher levels of state repression closer to sites of natural resources, and that overall levels of repression will be lower in areas with resources that require multinational investment than in areas with resources that the state can extract with its own capabilities. This is tested using a logit model and PRIO-GRID cell-years and repression data from the UCDP's Georeferenced Event Dataset."
bibliography: MAbib.bib
---

```{r setup, include=FALSE}
#all done in R 3.6.1. Note this is the version that was circulated and successfully defended.
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls()) 
require("knitr")
opts_knit$set(root.dir = "C:/Users/Steven Saroka/Documents/Master's Work/Data")
library(dplyr)
library(tidyverse)
library(readxl)
library(ggplot2)
library(stargazer)
library(texreg)
library(sjPlot)
library(effects)
library(glmnet)
library(doParallel)
library(stats)
library(scales)
library(caret)
library(xtable)
library(yaImpute)
library(rgeos)
library(fields)
library(gridExtra)
library(ggpubr)
library(geosphere)
library(MASS)
library(AER)
library(vcd)
library(car) #vif
library(pscl)
library(ggplot2)
library(regclass) #VIF
library(ltm) #biserial.cor
```

# Introduction

When and how do resource endowments contribute to state repression? Anecdotal evidence suggests undertheorized variation, as illustrated by the contrasting cases of Nigeria and Zimbabwe. In Nigeria’s southern Niger Delta region, the site of the state’s oil reserves, grievances regarding the state’s failure to share the benefits of oil wealth enabled the rise of a mixture of criminal and insurgent groups. In particular, the rise of the Movement for the Emancipation of the Niger Delta (MEND) in 2006 was marked by an insurgent focus on attacking oil-related facilities and kidnapping associated personnel [@Asuni19;@ICG06]. A counterinsurgency campaign was followed in 2009 by a government amnesty, which led to an increase in oil production, but failed to prevent the rise of another insurgent group, the Niger Delta Avengers, in 2016 [@BBC;@Forbes]. While the details of this insurgency are more complex [@Nwankpa14; @AghedoOsumah15], this case is notable for the government attempts to repress and, when repression was unsuccessful, negotiate with insurgents who were threatening the extraction of potentially lucrative resources. Despite the ultimately temporary nature of the bargain, this outcome still sharply contrasts with government action in Zimbabwe. There, the discovery of the Marange diamond deposits in 2006 was followed by efforts by the national government to exclude foreign companies from investment in these deposits, in favor of state-owned companies. A diamond rush was followed by police repression beginning in late 2006, with military units moving into the area in 2008 and overseeing continued repression and forced civilian labor [@HRW09]. 

The contrast of an amnesty in Nigeria with continued repression in Zimbabwe raises a question: what caused the variation in strategies employed by the state in these two cases? Why did the government of Nigeria ultimately offer an amnesty while the government of Zimbabwe continued its repression? More generally, when and how do resources influence a controlling state’s decision to repress its citizens or restrain itself? In this paper, I develop a theory of state repression as a means of consolidating control over resource-rich areas with the ultimate aim of profiting from those resources. As different kinds of resources require different levels of outside investment from multinational corporations to extract and thus profit from them, states may restrain their use of repression with the goal of attracting the necessary outside investment to enable resource extraction and maximize the profits from these resources. This theory yields two hypotheses that I test empirically using data on state repression and resource locations. This theory receives support, and I close with a discussion of potential improvements and extensions for future work.

# Literature Review

The study of natural resources and state repression has, over time, become closely linked to a literature on both internal conflict and the effects of resources on rebellion. While extant work has naturally focused on geographic factors such as resource location and structural factors such as economic incentives for engaging in conflict, this review of the literature also highlights undertheorized elements of this story, particularly with regards to the differing profitability of different resources, as well as a lack of substantial consideration of the role of multinational investors. I review each of these aspects of the literature in turn, before closing with a summary of the gaps revealed by this literature that my theory is intended to fill.

The linkage of natural resources and suboptimal governance outcomes, such as state repression or civil war, is not necessarily new. Relatively early work such as Le Billon [-@LeBillon01] argued that resources could become integrated into the political economy of conflicts, as opposing actors attempt to exploit them, but that specific social processes drive a society’s risk of war due to resources. Ross [-@Ross01], by contrast, generalized by arguing that the resource curse in oil-producing states was due to rentier state effects; this theoretical development drew on earlier work on state development as arising from bargaining between tax-seeking governments and citizens whom they wished to tax [@BatesLien85]. A review of research in this area by Ross [-@Ross15] finds that a resource curse effect exists for petroleum, as its income makes authoritarian regimes more durable while increasing the probability of some kinds of corruption. Additionally, both petroleum and other resources may trigger or prolong conflict in low- or middle-income states. However, Ross [-@Ross15] notes that there is a general lack of consensus regarding the precise causal mechanisms behind the resource curse, and why this literature has relatively strong findings for petroleum but weak or contradictory findings for other kinds of natural resources. Why these findings differ across resource types remains unexplored, and this is a gap I seek to remedy with my theory.

There is also a substantial literature on state repression; while earlier work often focused on assorted state-level predictors of repression, more recent work here has linked natural resources and state repression. A general definition of state repression is given by deMeritt: “the threat to subdue or act of subduing someone by institutional or physical force. Political violence is a particular form of repression involving the threat to use or actual use of physical force to achieve political goals” [-@deMeritt16, p. 2]. Notably, she states that “repression and political violence are strategic policies that governments employ in pursuit of important political and/or military objectives. The most fundamental of these objectives is the maintenance of control” [-@deMeritt16, p. 2]. This definition of repression matches well with that of Besley and Persson [-@BP09], who define state repression as one-sided violence by the state. Early cross-national studies focused on democracy levels, social inequality, and economic growth as meaningful predictors of state repression [@Henderson91; @Davenport95]. Later work added nuance to this, noting that the beneficial effects of democracy may have relatively small effect sizes compared to conflict, either civil or interstate [@Davenport04]. Additionally, autocratic regimes are not necessarily monolithic in their repression efforts, with single-party autocracies repressing less than other autocracies [@Davenport07]. Davenport’s work is also notable for proposing the “Law of Coercive Responsiveness,” which argues that state repression is a response by governments to perceived threats [@Davenport07b]. Besley and Persson [-@BP09] identified poverty, rents from natural resources, and weak political institutions as root causes of political violence; the overlap between these factors and the resource curse literature indicates a linkage of these two phenomena.

Some scholars have argued that extant work has failed to fully model the strategic nature of state repression and dissent in the form of popular protests [@Pierskalla10]. Specifically, Pierskalla argues that this failure is why tests of the effectiveness of government repression in suppressing popular protest have found a range of relationships with no clear consensus. Similarly, Ritter and Conrad [-@rc2016] argue that preexisting work on anti-government dissent and government repression has failed to adequately grapple with their endogeneity, as strategic dissidents and governments consider each other’s expected responses before acting. To address this, they use rainfall as an instrumental variable, finding that where states engage in preventative repression, there are no significant effects of dissent on responsive repression. Additionally, violence may not always be a successful tool of repression, and has potential to backfire on governments using it [@Suttonetal14]. Ritter [-@Ritter14] elaborates on this by using a formal model to show that the reciprocal nature of dissent and repression indicates that the same independent variable can have divergent effects. She finds that while increased job security for executives decreases the probability of repression occurring, it increases the severity of any repression that does occur. Finally, Chenoweth, Perkoski, and Kang [-@Chenowethetal17] find in a review of both the state repression literature and the more practice-focused nonviolent resistance literature that regime type conditions scope and intensity of repression, with states over a democratic threshold much less likely to repress.

Approaching the linkage of resources and contentious politics from a different angle, other scholars have drawn linkages between resource wealth and its ability to fuel conflict by both motivating rebellion and potentially funding it. Early work by Collier and Hoeffler [-@CoHo98;-@CoHo04] emphasized the role of economic factors in influencing the viability of engaging in civil war, theorizing that the lure of economic gains from conflict or the low opportunity costs of engaging in it may provide sufficient impetus for civil war. These findings were supplemented by country-level analysis, such as Fearon and Laitin’s [-@FL3] focus on favorable conditions for insurgency as predictors of civil war. They emphasized the permissive role of a weak central government as well as enabling factors such as rough terrain and rebel knowledge of a local population sufficiently large to conceal them. Echoing work on the resource curse, however, the precise causal mechanisms underlying these findings were initially unclear [@Humphreys05]. Weinstein [-@Weinstein07] helped to fill this gap, arguing that resource availability impacted the types of recruits who joined nascent rebel groups, with resource-rich groups attracting more opportunistic recruits while resource-poor groups were forced to rely on social endowments. These recruit types then influenced organizational discipline, ultimately impacting treatment of civilian populations under their control. In a related fashion, others such as Reno [-@Reno02] argued that economically successful actors may respond to the collapse of the formal state and its patronage networks by becoming well-armed insurgents, with the prospect of personal economic gain enabling them to recruit individuals who would otherwise have joined more reformist movements. Similarly, Bates argued that the breakdown of political order (including the occurrence of civil war) seen in the African context by the close of the twentieth century was due to the failure of a prior equilibrium bargain between citizens and violence specialists which, if upheld, supported stable political order [@BGS02;@Bates08]. The breakdown of this bargain, according to this framework, led many elites to perceive violent predation as more profitable than upholding existing political institutions and bargains. 

Other scholars have used exogenous price shocks to estimate the impact of resources on conflict. Angrist and Kugler [-@AK08] use an exogenous upward shift in coca cultivation and its price in Colombia as a natural experiment to test the link between illegal resource cultivation and civil conflict. They conclude that increased coca growth led to limited economic gains for some actors in some regions, but also to worsened conditions of violence in those same regions. Other scholars have also reported similar findings in the Colombian context [@DV13;@CD17]. While this focus on a specific type of resource would appear to threaten generalizability, other findings have been congruent with this. With regards to oil, scholars find that the discovery of oil fields can increase the probability of conflict [@LM14]. Finally, Berman, Couttenier, Rohner and Thoenig [-@BCRT17] find that increased market prices for minerals both increase conflict risk and allow rebel groups to engage in both more and wider-ranging violence by providing a source of financing. 

Finally, there has also been substantial work on the intersection of repression and civil conflict. This literature has emphasized the relationship between them, showing that state repression can be both used by the state in an attempt to preemptively suppress potential dissenters, as well as a tool of conflict should the state face armed rebellion. Cunningham, Gleditsch, and Salehyan [-@Cunninghametal09] examine civil war duration and outcome by disaggregating both rebel capacity and state repression, arguing rebel strength can be disaggregated into offensive and defensive military capabilities, while a state’s repression ability can also vary by location within a state, with lessened ability at the periphery. They argue that strong rebels cause conventional-looking conflicts with decisive military outcomes, while weak rebels can prolong a civil war by hiding at the periphery of the state. Elaborating on this theme, Danneman and Ritter [-@DannemanRitter14] find that in response to civil war occurring in neighboring states, state authorities will engage in preemptive repression to prevent the diffusion of civil war into their own state, as they anticipate civil war externalities will change the incentives of potential rebels. They argue that state authorities ultimately repress in an attempt to avoid the fate of their warring neighbors. Should they fail to prevent rebellion, Fjelde and Hultman [-@FH14] find that conflict actors such as states may use ethnicity as a collective targeting cue, engaging in violence against civilians in an attempt to deprive the rebel movement of its civilian support. As such, states may engage in civilian targeting as a strategic form of repression. Empirical evidence shows that governments may turn to mass killings as a strategy to remove bases of insurgent support [@VHB04], while Zhukov’s [-@Z17] historical work finds that the amount of violence against civilians in German-occupied Belarus was dependent on the extent to which combatants depended on local or external sources of support.

This review of the literature shows that while resources and violence in the form of state repression and civil war are linked, with resources increasing both the incentives of rebels to go to war and their strength once conflict has begun and the incentives of governments to engage in violence to secure these resources, the strategic use of state repression as it relates to the control of valuable resources remains an undertheorized area. Throughout this literature, studies of repression often implicitly treat repression as distributed evenly throughout a state—when the effects of state repression are considered, the specific locations of that repression are often not taken into account, meaning that analyses do not explain why states simultaneously engage in repression in one region but not in another. This leaves undertheorized the question of whether the presence of resources influences a state’s decision to use repression in a given area. A second, related question concerns why states vary in their repression. To return to my opening examples, why was there continued repression in Zimbabwe while Nigeria eventually turned to negotiation? In the next section, I answer these questions with a theory of resource type variation and government repression incentives.

# Theory

Given this literature, it seems a reasonable starting assumption that states use internal repression as a means of consolidating control over territory and any resources it may contain. For the sake of parsimony, this theory treats the state as a unitary actor. An implicit assumption regarding repression that applies throughout the rest of this paper, and also forms an important scope condition of this theory, is that the state's monopoly on the use of force means that the state is always using or threatening some level of force against its population [@tilly1975]. I make no initial assumptions about the amount or type of repressive force used: a state may use the bare minimum necessary to enforce its laws via police action, or engage in more draconian repressive action such as mass killings.

Another important opening consideration is that not all territory contains natural resources of equal value. Resources are usually not uniformly distributed over a state’s territory, as geological processes lead to concentrations of minerals or oil in some areas but not others. This haphazard distribution is compounded by the need to discover natural resources. Previously undiscovered natural resources can be found by accident or prospecting efforts, introducing a further element of chance to a state’s known distribution of natural resources as certain resource concentrations may be overlooked. Additionally, market values for resources are prone to fluctuation, as demonstrated by global oil markets, leading to variations in value of resources across resource types and over time. 

As a state can use internal repression as a means of consolidating control over areas with known resources within its borders, this implies that the state must have some motive for consolidating its control. In this theory, I adopt the assumption that states wish to maximize the profits they accrue from natural resources within their territory. Control of those natural resources is a necessary prerequisite for that goal, though not necessarily a sufficient condition for it—a point to which I return below in the discussion of resource types. Here, these starting considerations imply that a state’s incentives to engage in repression against its citizens will vary by location. While states may engage in different amounts of repression in different areas for a variety of reasons, such as preexisting unrest in one region but not in another, I theorize that holding those other motivations constant, the presence of exploitable resources of any kind should predict relatively higher levels of state repression in order to secure the area, and thus those resources, for the direct benefit of the state. Theoretically, this repressive violence is solely motivated by the state’s desire to secure the maximum amount of resource profits for itself, and so should not be conditional on the type of resource under consideration, as all resources have at least some value. Additionally, this indicates an implicit sharp decline in the explanatory power of this mechanism as the distance between an incident of repression and the closest site of natural resources increases, as the motivation for repression due to the presence of a resource should fade as the proximity to that resource diminishes. This suggests a first, general hypothesis:

*H1: There will be more state repression closer to sites of natural resources.*

However, this theory is further complicated by variation in the level of outside investment from multinational corporations required for the state to enjoy the profits from a given resource. Some resources may require little or no outside investment before the state can extract and profit from them, while others may require substantial external investment. In these latter cases, this requirement for external investment may place these resource profits beyond the reach of the state by itself [@rossbook;@colganbook]. However, this access can be facilitated by multinational corporations committing substantial capital and personnel to extractive ventures. If so, this implies that a reasonable state lacking such extractive capacity must consider the investment incentives of such external investors when choosing its actions, including its level of repression—in short, the state must consider how best to attract investment. This involves a brief consideration of the preferences of these external investors, a term which I use synonymously with multinational corporations. For the sake of theoretical simplicity, this theory assumes that these corporations are profit-seeking, but also wish to avoid substantial risk to their personnel or corporate assets [@BSY14], such as physical damages due to popular unrest or outright expropriation of production facilities by the state’s government. These investors have no fundamental preferences over state repression or lack thereof—their primary concerns are with the profitability of the venture and the security of their assets.

Thus, this kind of external investment is only necessary in cases where resource extraction would require the provision of large amounts of external investment and expertise, which the state may be unable or unwilling to provide.^[This condition covers states at all levels of development: while developing states may lack the funding or human capital, developed states may not wish to provide such funding if the private sector can assume the costs and risks of such an operation.] For the purposes of illustration for the rest of this section, and to match with the later operationalization in my empirical analysis, I conceptualize of this difference in required investment through reference to two archetypal resources, which are often discussed in terms of being lootable and not lootable (terms I treat as synonymous with easy- and hard-to-extract): diamonds and oil. Diamonds are here theorized to require little to no outside investment before they can be extracted and sold, as they can be mined with relative ease compared to extracting oil deposits. Oil deposits, by contrast, require substantial investment into the drilling and extraction infrastructure necessary to both extract the oil and transport it to market. Thus, profits from diamonds (or other easy-to-extract resources) can be obtained by the state with minimal regard for outside investors, as they are not necessary for the state to enjoy the profits from these resources. By contrast, profits from oil reserves (or other hard-to-extract resources) cannot be obtained by most states, especially those that are still developing, without substantial outside investment. 

This variation in the need for outside investment also ultimately solves what at first seems to be a potentially intractable commitment problem implied by the incentives of this theory: the clash between the desire of the state to maximize the profits from its resources and the desire of the firm to maximize its own profits from its investment, given that the state may use repressive violence to seize control of resources and thus deprive the firm of value. However, so long as the state requires the expertise of the firm to extract these resources, and thus to derive any substantial profits from them, the state has differential incentives to repress in resource-rich areas based on the type of resources: those areas with resources that require outside investment will experience minimal amounts of repression, as the state must avoid scaring away firms that may fear violent repression will be used to expropriate their assets, while those areas with resources that do not require such investment will experience higher amounts of repression as the state can directly seize resources for itself without fearing a loss of profits.

To summarize, this theory argues that profit-maximizing states, seeking to maximize the profits from the resources within their territory, face different incentive structures for their choices conditional on the type of resources they wish to exploit. When considering lootable and easy-to-extract resources, states have no need to consider whether their behavior will deter potential investors, as the presence of those investors is not necessary for the state to maximize its profits. As such, they will be free to engage in repressive violence in these cases to secure these resources. Such violence will be especially incentivized if the state fears a rebel group is also seeking to control these resources, and wishes to seize them before a rebel group does. By contrast, if the state is considering non-lootable resources that are difficult to extract, and thus require the investment of outside firms to enable their extraction and maximize their profitability, states are aware that investors will be unwilling to invest in an area where repression or outright civil war would endanger their assets or extractive efforts. States are aware that they cannot simply seize all profits from these resources for themselves, but must share them with these outside investors if they wish to gain their cooperation and thus a share of the profits—that is, they must avoid engaging in repression against investors and their personnel intended to seize sole control of the resource, which would drive off the investor and leave the state with no profits. Additionally, if they are facing rebel violence, they may attempt to pacify the rebellion via negotiation in order to minimize violence. In this case, the state maximizes its profits by restraining its predation. 

This logic suggests, fundamentally, that states will seek to establish ownership via repression in areas containing resources that do not require outside investment to extract, but will engage in lower levels of repression in areas with resources that do require outside investment. In this way, the necessary presence of multinational corporations can incentivize more peaceful outcomes, as their necessity restrains the state’s level of repressive violence—ultimately, resource type drives state repression or the lack thereof. This indicates that repression should roughly be a function of whether states require international investment to profit from their resources: repression will be lower if they do, and higher if they do not. To restate this in terms of the oil and diamond resources, this implies that states will engage in less repression in areas containing oil than in those containing diamonds. This indicates a second hypothesis:

*H2: Overall levels of repression will be lower in areas containing hard-to-extract resources than in areas containing easy-to-extract resources.*

# Methods

Testing these hypotheses quantitatively requires both data that reflects the key elements of this theory and statistical models that can accurately estimate the types of data being used. This implies several requirements for any research design. First, and most fundamentally, there is a requirement for data on resource locations and incidents of state repression, as both of these are crucial variables in the theory. Second, due to the importance of geographic proximity in this theorized relationship between state repression and resource locations, these data sources must have some embedded means of providing information on the geographic closeness of these two phenomena. Without some way of linking the two, any analysis would risk finding spurious relationships between resources and incidents of repression that were located in different parts of the world. Third, to avoid selection on the dependent variable, there must be variation in the occurrence of state repression within whatever unit of analysis is used. Fourth, these data sources must be able to be examined quantitatively. Fifth, these data must have broad geographic and temporal coverage, as the theory does not bound itself to specific regions or periods of history. To fulfill these requirements, I combine the civilian casualty information from incidents of state repression in the UCDP's Georeferenced Event Dataset [@SundbertMelander13] with the Peace Research Institute Oslo's (PRIO's) PRIO-GRID dataset [@priogridcode]. This enables me to test my hypotheses using a logit model. In the following sections, I first describe the data sources from which I created my dataset, before presenting some descriptive statistics from the dataset. I then present and elaborate upon the results of the logit model.

The UCDP's Georeferenced Event Dataset [@SundbertMelander13] covers 1989-2018, with global (excepting Syria) coverage during that time [@Stina19]. PRIO-GRID contains information on the presence of both oil and diamond deposits within the approximately 55 by 55 kilometer grid cells that comprise that dataset, with global coverage for the world’s landmasses [@LRT7; @Gilmore5; @LGG5]. From the Georeferenced Event Dataset, there is information on the number of deaths from incidents of one-sided violence^[Notably, some incidents contained 0 deaths according to the UCDP’s best estimate.] committed by governments against their civilian population per year within each PRIO-GRID cell, as well as a binary indicator of whether those occurred during an active conflict-year as defined by the UCDP.^[This binary indicator takes a value of 1 if the grid cell-year experienced any active conflicts as defined by the UCDP, which are state-based conflict, non-state conflict, and one-sided violence [@Stina19]. This ensures that this indicator accurately reflects whether there is any substantial violence occurring in the cell-year, not just whether one-sided violence was perpetrated by the government during that cell-year, which would prevent the use of this as a control for civil wars.] By construction of the GED, the victims of one-sided government violence are always civilians; this dataset does not, for example, include combatant deaths from conflict with insurgent groups, and so there is no concern that other types of violence are being erroneously included in this analysis. I operationalize state repression as incidents of one-sided violence in this dataset where the perpetrator was the government. As this dataset was built to be compatible with the PRIO-GRID dataset, this enables me to generate a cell-year tally of civilian deaths within each cell for each year, that I then match with the PRIO-GRID cells. Notably, while the Georeferenced Event Dataset has coverage from 1989-2018, the PRIO-GRID dataset only contains coverage from 1946-2014, with selected variables within it covering fewer years within that range. My unit of analysis is thus the grid cell-year.

I include a binary indicator variable for whether a cell-year experienced any violence recorded in the GED, as some instances of GED violence produced zero fatalities, which would otherwise be indistinguishable from those cell-years with zero fatalities due to a lack of violence. The PRIO-GRID dataset also contains numerous useful controls at the cell level. These include the gross cell product in US dollars at purchasing-power-parity, which is available for all cells for the years 1990, 1995, 2000, and 2005 and originally calculated by Nordhaus [@nordhaus2006]. I fill in the GCP for missing years by filling in a cell's last known GCP in the following four years, resulting in GCP coverage of 1990-2009. While this makes the assumption that GCP per year is related to foreign investment at the cell level, this assumption appears plausible for two reasons. First, it makes conceptual sense, as increased investment into a cell should increase the amount of capital within a cell as well as potentially boosting production capabilities, increasing its gross product. Second, extant studies have shown associations between foreign direct investment and GDP at the national level [@AB17].

I also include controls for the total population of a cell originally developed by CIESIN [-@ciesin2005], which are similarly available in five-year intervals from 1990 to 2005 and for which I fill in missing values in the same way. I include an indicator variable for the presence of lootable diamonds, as defined by PRIO's Diamond Resources dataset [@Gilmore5; @LGG5]. This dataset contains locations and dates of both discovery and beginning of production for global diamond deposits up to 2005. I also include an indicator variable for onshore petroleum deposits, from the PRIO Petroleum Dataset v.1.2's onshore locations [@LRT7] which covers petroleum deposits discovered through 2003 [@TRL7]. Thus, these controls include only those diamond and petroleum deposits that had a known discovery or beginning of production date. While it would be optimal if both of these datasets were updated with discoveries through the present, the fixed geographic nature of natural resource locations should partially mitigate this concern.

As a result of combining these different variables with difference amounts of coverage over time, my final data set includes all PRIO-GRID cell-years from 1990 through 2009, with GED event counts per cell-year matched to their proper grid cells. This dataset meets the requirements established at the beginning of this section. It includes data on resource locations and incidents of state repression, while containing a measure of geographical closeness by indicating whether each cell experienced state violence and contained resources. This limits the potential effects of resources to the area of the grid cell. Importantly, this dataset also provides variation on several key variables. Most importantly, there is variation in the dependent variable of state repression, as some cells never experience repression, while those cells that do experience repression often record different levels of fatalities. The repression data does record zero deaths in some cases of repression, indicating that it is not merely capturing instances of lethal repression, alleviating a potential selection concern given that the theory does not distinguish between lethal and nonlethal repression. There is also variation in the occurrence of natural resources in any given grid cell. Finally, as elaborated on below, this dataset can be subjected to quantitative analysis.

## Descriptive Statistics

Within my timeframe of 1990-2009, the UCDP's Georeferenced Event Dataset [@SundbertMelander13] contains 7,500 incidents of violence perpetrated by 55 distinct governments. The average event of violence has 76.97 casualties per event, but this average conceals substantial variation in fatalities by region and year. As shown in Figure 1, Africa has the highest average fatalities, followed by Europe. However, that chart of averages conceals substantial yearly variation within regions. The series of histograms in Figure 2 shows the summed deaths per year for each region.

```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE}
#read in data. name kept at data5 for continuity; all other scraps imported from the process of building the cell-year dataset

#UCDP OSV dataset
osv <- read_csv("ucdp-onesided-191.csv")

#filter to get gov IDs
osv_id <- filter(osv,is_government_actor==1)
gov_id_codes <- osv_id$actor_id
gov_id_codes <- unique(gov_id_codes)

#read in UCDP GED
ged <- read_csv("ged191.csv")

#generate version of GED with only gov-perpetrated violence against civilians in it
ged_gov <- filter(ged,side_a_new_id %in% gov_id_codes) #generates dataset with only govs as perps
ged_gov <- filter(ged_gov,type_of_violence==3) #narrows dataset to only have one-sided violent events against civilians, out of that gov-only list.
ged_cd <- filter(ged_gov, year > 1989)

ged_cd <- filter(ged_cd, year < 2010)

data5 <- ged_cd #remove row counter column
```


```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE}
unique(data5$year) #check range of years
unique(data5$side_a) #check number of distinct govs
mean(data5$best) #59.33 dead per incident on avg

#Average Fatalities by Region
#Generating average fatalities by region and state:
reg_avg <- data5 %>% group_by(region) %>% summarize(avg=mean(best)) %>% arrange(avg)
```

```{r, echo=FALSE, fig.width=5,fig.height=3}
#barplot of avg fatalities by region
avgfatplot <- ggplot(reg_avg, aes(x = region, y = avg)) +
  geom_bar(stat = "identity") +
  labs(x = "Region", y = "Average Fatalities",
       title = "Figure 1: Average Fatalities Per Incident By Region") #+
#  theme(plot.title = element_text(size=16)) +
#  theme(axis.title.x = element_text(size=20)) +
#  theme(axis.title.y = element_text(size=20))
avgfatplot
#ggsave("avgfatplot2.pdf", width = 7, height = 7)
```


```{r echo = FALSE, warning=FALSE, results='hide',message=FALSE}
ged_gov_afr <- filter(data5,region == "Africa") #dataframe for Africa
```
```{r echo=FALSE, fig.height=4}
afr_yrfat<-ggplot(ged_gov_afr,aes(year,best))+geom_bar(stat = "identity")+
  labs(x = "Year", y = "Deaths/Year", title = "Summed Civilian Deaths by Year in Africa") +
  theme(plot.title = element_text(size=8)) #+
 # theme(axis.title.x = element_text(size=16)) +
  #theme(axis.title.y = element_text(size=16))
#afr_yrfat
#ggsave("afr_yrfat.pdf", width = 7, height = 7)

```
```{r echo = FALSE, warning=FALSE, results='hide',message=FALSE}
ged_gov_eur <- filter(data5,region == "Europe") #dataframe for Europe
```
```{r echo=FALSE, fig.height=4}
eur_yrfat <- ggplot(ged_gov_eur,aes(year,best))+geom_bar(stat = "identity")+
  labs(x = "Year", y = "Deaths/Year", title = "Summed Civilian Deaths by Year in Europe") +
  theme(plot.title = element_text(size=8)) #+
# theme(axis.title.x = element_text(size=16)) +
# theme(axis.title.y = element_text(size=16))
#eur_yrfat
#ggsave("eur_yrfat.pdf", width = 7, height = 7)
```
```{r echo = FALSE, warning=FALSE, results='hide',message=FALSE}
ged_gov_as <- filter(data5,region == "Asia") #dataframe for Asia
```
```{r echo=FALSE, fig.height=4}
asia_yrfat <- ggplot(ged_gov_as,aes(year,best))+geom_bar(stat = "identity")+
  labs(x = "Year", y = "Deaths/Year", title = "Summed Civilian Deaths by Year in Asia") +
  theme(plot.title = element_text(size=8)) #+
 # theme(axis.title.x = element_text(size=16)) +
  #theme(axis.title.y = element_text(size=16))
#asia_yrfat
#ggsave("asia_yrfat.pdf", width = 7, height = 7)
```
```{r echo = FALSE, warning=FALSE, results='hide',message=FALSE}
ged_gov_me <- filter(data5,region == "Middle East") #dataframe for Mid East
```
```{r echo=FALSE, fig.height=4}
me_yrfat <- ggplot(ged_gov_me,aes(year,best))+geom_bar(stat = "identity")+
  labs(x = "Year", y = "Deaths/Year", title = "Summed Civilian Deaths by Year in the Middle East") +
theme(plot.title = element_text(size=8)) #+
 # theme(axis.title.x = element_text(size=16)) +
  #theme(axis.title.y = element_text(size=16))
#me_yrfat
#ggsave("me_yrfat.pdf", width = 7, height = 7)
```
```{r echo = FALSE, warning=FALSE, results='hide',message=FALSE}
ged_gov_am <- filter(data5,region == "Americas") #dataframe for Americas
```
```{r echo=FALSE, fig.height=4}
am_yrfat <- ggplot(ged_gov_am,aes(year,best))+geom_bar(stat = "identity")+
  labs(x = "Year", y = "Deaths/Year", title = "Summed Civilian Deaths by Year in the Americas") +
  theme(plot.title = element_text(size=8))# +
 # theme(axis.title.x = element_text(size=16)) +
  #theme(axis.title.y = element_text(size=16))
#am_yrfat
#ggsave("am_yrfat.pdf", width = 7, height = 7)
```

```{r, echo=FALSE}

#grid.arrange(afr_yrfat,eur_yrfat,am_yrfat,me_yrfat,asia_yrfat)

#this creates stacked bar plot
#testplot <- ggplot(data5,aes(year,uncivdeath,col=region))+geom_bar(stat = "identity")+
 # labs(x = "Year", y = "Fatalities per Year", title = "test") #+
#  theme(plot.title = element_text(size=16)) +
 # theme(axis.title.x = element_text(size=16)) +
  #theme(axis.title.y = element_text(size=16))

fig2 <- ggarrange(afr_yrfat,eur_yrfat,am_yrfat,me_yrfat,asia_yrfat, 
          ncol = 2, nrow = 3,font.label = list(size = 8, color = "black", face =
  "plain", family = NULL))

annotate_figure(fig2, top = text_grob("Figure 2: Summed Deaths by Year by Region"))
```

Within the cell-year framework, Figure 3 shows the yearly average number of deaths from GED events per year across all cells in the dataset. While this indicates averages very close to 0, with the exception of the year 1994 (which records several instances of mass killings from the Rwandan Genocide), this average is driven down by a large number of zeros due to a lack of violent events in many cells. To remedy this, Figure 4 shows yearly average civilian deaths, calculated only from cells in which at least one GED event occurred per year. This figure excludes 1994 due to the distortionary effects of the Rwandan Genocide; Figure 4.1, which includes the Rwandan Genocide, is shown in the Appendix. This shows more substantial variation, with the majority of years showing an average of under 50 deaths. Figure 5 shows that, despite these casualty numbers, the total number of PRIO-GRID cells containing at least one event of violence per year is quite low, compared to the total of 64,818 individual cells in my dataset. Finally, Figures 6 and 7 show the average gross cell product and average cell population for the original years in which they were measured, which were 1990, 1995, 2000, and 2005, both of which increase in a roughly linear fashion.  

```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=FALSE}
#### Data read-in, filtering, and cleaning
### note that all code chunks to do solely with developing dataframe are eval=F to save compiling time

### Read in and filter GED data ###

#UCDP OSV dataset
osv <- read_csv("ucdp-onesided-191.csv")

#filter to get gov IDs
osv_id <- filter(osv,is_government_actor==1)
gov_id_codes <- osv_id$actor_id
gov_id_codes <- unique(gov_id_codes)

#read in UCDP GED
ged <- read_csv("ged191.csv")

#generate version of GED with only gov-perpetrated violence against civilians in it
ged_gov <- filter(ged,side_a_new_id %in% gov_id_codes) #generates dataset with only govs as perps
ged_gov <- filter(ged_gov,type_of_violence==3) #narrows dataset to only have one-sided violent events against civilians, out of that gov-only list.

##create cell/year version of GED for ease of merging, containing active conflict dummy.
ged_gov_cy2 <- ged_gov %>% group_by(priogrid_gid, year) %>% summarise(civdeaths = sum(best))

#create version with active conflict dummy for every instance of PRIOGRID_GID occurring in the GED, which should provide a complete list of all prio-grid cells affected by UCDP-active conflicts (regardless of OSV)
ged_cd <- ged %>% group_by(priogrid_gid, year) %>% summarise(activeconflict = any(active_year))
ged_cd <- ged_cd %>% rename(gid = priogrid_gid) #rename for ease of joining
ged_cd <- filter(ged_cd, year > 1989)
ged_cd <- filter(ged_cd, year < 2010)

#testing that the code to find activeconflict did what it should: it works
#x<- filter(ged_gov,priogrid_gid == 160396)
#y<- filter(x,year == 2003)
#sum(y$best) #29

#note to self: if you want a version which only controls for state-based and non-state active conflicts, but not OSV, do what you did for ged_cd but instead add type_of_violence to the group-by, drop the type corresponding to OSV, then make the binary indicator

#start of the binary violence indicator, since sometimes violence has no deaths
ged_gov_cy2$binviol <- 1

###########################################################################################
### Read in  PRIO GRID data
#static contains oil and petro deposits WITHOUT a known discovery/start of production year--not even sure I want this
#static <- read_csv("C:/Users/Steven Saroka/Documents/Master's Work/PRIO GRID/Static Variables.csv")
#yearly contains oil and petro deposits WITH a known discovery/start of production year. These are in binary form
yearly <- read_csv("C:/Users/Steven Saroka/Documents/Master's Work/PRIO GRID/Selected Yearly Variables for 1946-2014.csv")

#reorder by GID then year, since it's out of order and that messes up na.locf filling. Filter down to 1990-2009 so that imputation works properly
yearly2 <-dplyr::arrange(yearly,gid,year) 
yearly2 <- filter(yearly2, year > 1989)
yearly2 <- filter(yearly2, year < 2010)


#all blank spaces from the CSV read in as NA automatically, but codebook does not indicate presence of any NA. Turned to 0 instead:
yearly2 <- replace_na(yearly2,list(diamsec_y = 0, diamprim_y = 0, petroleum_y = 0, gem_y=0, goldplacer_y=0,
                                goldvein_y=0,goldsurface_y=0))
#as GCP and population measures are available every 5 years, I fill in NAs using the last available observation
yearly2$gcp_ppp <- zoo::na.locf(yearly2$gcp_ppp, na.rm = F)
yearly2[,14:21] <- zoo::na.locf(yearly2[,14:21], na.rm = F) #population measures


```

```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=FALSE}

#cut down to 1990-2009 to match cut-down PRIO coverage
ged_gov_small <- filter(ged_gov_cy2, year > 1989)

ged_gov_small <- filter(ged_gov_small, year < 2010)

#rename for continuity with previous code
yearly_small <- yearly2
#add unique ID for all yearly_small rows, as a full_join returns extra rows for some reason
yearly_small$uniqueID <- 1:nrow(yearly_small)

#merge uses full_join bc we need cells with and without violence each year. This is reason for binary violence indicator to ged_gov_cy2 since sometimes violence happens but has 0 deaths.

#rename for ease of joining
ggs <- ged_gov_small %>% rename(gid = priogrid_gid)

#use full join so we have both cells with and without violence
data2 <- full_join(ggs,yearly_small,by=c("gid","year")) 
#for some reason data still has 1989 in it, so filter out AGAIN
data2 <- filter(data2, year > 1989)
#join all active year cells mentioned in GED
c <- full_join(data2,ged_cd,by=c("gid","year")) 

#finish filling in violence binary indicator with 0 for non-violence cells, and number of deaths for non-violence cells as 0
data3 <- c %>% replace_na(list(civdeaths = 0,binviol=0,activeconflict=0))

#join returns 9 extra obs above the row number in yearly_small, but since all rows in yearly_small had a unique ID corresponding to their row number before the join, I can just drop all rows that don't have that idea, which are NAs
data4 <- data3 %>% filter(uniqueID >= 1)

#testing that my binviol and death count indicators worked: they do, afaik
#bvt <- data4 %>% filter(binviol == 0)
#sum(bvt$dead)
#bvt <- data4 %>% filter(binviol == 1)
#sum(bvt$dead)
#dt <- data4 %>% filter(dead !=0)
#sum(dt$dead)

#create logged deaths
data4$civdeathslog <- base::ifelse(data4$civdeaths == 0, data4$civdeaths+1,data4$civdeaths) #to avoid -Inf when logging
data4$civdeathslog <- log(data4$civdeathslog)

#create only secondary diamonds and/or petroleum present dummy
data4$binresource <- if_else(data4$diamsec_y == 1|data4$petroleum_y == 1,1,0)


#create any resource at all dummy variable
data4$binresourceany <- if_else(data4$diamsec_y == 1|data4$diamprim_y == 1|data4$petroleum_y == 1| data4$gem_y == 1| data4$goldplacer_y == 1|data4$goldvein_y==1|data4$goldsurface_y==1,1,0)

write.csv(data4,file = "Apr2020revdata.csv")

```


```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=T}
#read in
data <- read.csv("Apr2020revdata.csv")
data <- data[,-1] #remove row counter column
```


```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=T, fig.width=5,fig.height=3}
#Avg number of deaths per year across ALL cells (including those in which no deaths were recorded bc no instances of GED violence were recorded.)

fd1 <- data %>% group_by(year) %>% summarise(avg = mean(civdeaths))

ggplot(data = fd1, aes(x = year, y = avg)) + 
  geom_line() +
  geom_point() +
  labs(title = "Figure 3: Average of Civilian Deaths Per Year, All Cells", x = "Year", y = "Average Deaths",
       caption = "Note: This average is driven down by the number of cells in which no deaths were recorded.")+ 
  theme_bw() + #make the plot background blank w/grid lines
  theme(axis.title=element_text(size=8))
```

```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=T, fig.width=5,fig.height=3}
#Avg deaths per year, focusing only on cells in which GED violence actually occurred.

fd2 <- data %>% group_by(binviol,year) %>% summarise(avg = mean(civdeaths))
fd2 <- fd2[-1:-20,]

#ggplot(data = fd2, aes(x = year, y = avg)) + 
 # geom_line() +
  #geom_point() +
 # ggrepel::geom_text_repel(aes(label = avg), color = "black", size = 2.5, segment.color = "grey") +
  #labs(title = "Figure 2: Average of Civilian Deaths Per Year", x = "Year", y = "Average Deaths", caption = "Note: This figure only includes cells in which at least one UCDP GED event occurred.")+ 
  #theme_bw() #make the plot background blank w/grid lines

#alt plot: drop 1994 bc Rwandan genocide
fd2alt <- fd2[-5,]
ggplot(data = fd2alt, aes(x = year, y = avg)) + 
  geom_line() +
  geom_point() +
 # ggrepel::geom_text_repel(aes(label = avg), color = "black", size = 2.5, segment.color = "grey") +
  labs(title = "Figure 4: Average of Civilian Deaths Per Year in Cells \n with GED Violence", x = "Year", y = "Average Deaths", caption = "Note: 1994 dropped due to distortionary effects of Rwandan Genocide.")+ 
  theme_bw() + 
  theme(axis.title=element_text(size=8))

```

```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=T, fig.width=5,fig.height=3}
#Yearly counts of number of cells containing at least one GED event per year. Note for reference that the total number of cells in the data is 64818.


fd3 <- data %>% group_by(binviol,year) %>% summarise(nbv = n())
fd3 <- fd3[-1:-20,]


ggplot(data = fd3, aes(x = year, y = nbv)) + 
  geom_line() +
  geom_point() +
  ggrepel::geom_text_repel(aes(label = nbv), color = "black", segment.color = "grey") +
  labs(title = "Figure 5: Yearly Counts of Cells with At Least \n  One GED Event", 
       x = "Year", y = "Number of PRIO-GRID Cells")+ 
  theme_bw() + 
  theme(axis.title=element_text(size=8))
```

```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=T, fig.width=5,fig.height=3}
#Average gross cell product for years in which it was calculated:

fd4 <- data %>% group_by(year) %>% summarise(avg = mean(gcp_ppp))
fd4 <- fd4[c(1,6,11,16),] #bc gcp_ppp only actually measured in 1990, 1995, 2000, and 2005

ggplot(data = fd4, aes(x = year, y = avg)) + 
  geom_point() +
  ggrepel::geom_text_repel(aes(label = avg), color = "black", segment.color = "grey") +
  labs(title = "Figure 6: Average Gross Cell Product \n for Years Measured", 
       x = "Year", y = "Average")+ 
  theme_bw() + 
  theme(axis.title=element_text(size=8))

```

```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=T, fig.width=5,fig.height=3}
#Average cell population for years in which it was calculated:

fd5 <- data %>% group_by(year) %>% summarise(avg = mean(pop_gpw_sum))
fd5 <- fd5[c(1,6,11,16),] #bc pop_gpw_sum only actually measured in 1990, 1995, 2000, and 2005

ggplot(data = fd5, aes(x = year, y = avg)) + 
  geom_point() +
  ggrepel::geom_text_repel(aes(label = avg), color = "black", segment.color = "grey") +
  labs(title = "Figure 7: Average Cell Population \n for Years Measured", 
       x = "Year", y = "Average")+ 
  theme_bw() + 
  theme(axis.title=element_text(size=8))

```

## Results: Logit Model 

I test my hypotheses using a logit model. The dependent variable of the logit model is a binary indicator of whether an incident of repressive violence occurred within a given grid cell-year. I operationalize the presence of easy- or hard-to-extract resources through binary variables for the presence of lootable diamond and oil deposits, respectively, within a given grid cell for a given year. These enable me to test both of my hypotheses. If the presence of resources increases the probability of an incident of state repression, this will serve as support for my first hypothesis; thus, the first hypothesis will be supported if these variables have positive and significant effects on the probability of repressive violence. By contrast, the second hypothesis will be supported if the effect of easy-to-extract resources on the probability of violence is positive and greater than the effect of hard-to-extract resources on that same probability of violence. This model also includes several control variables. The first is a control for whether the cell-year was experiencing any active conflict, as defined by the UCDP [@Stina19], in order to control for the confounding effects of preexisting high levels of violence within a cell-year, such as those due to civil war. The second and third are standard controls for the gross cell product per cell-year and the cell’s population per cell-year, as described in the previous section. Finally, there is a control for the year.

## Analysis: Logit Model 

As shown in Table 1, all variables are significant except for the petroleum dummy variable. Additionally, the indicator variable for the presence of diamonds is positive, as predicted by my first hypothesis. Figure 8 shows the predicted effects of the presence of diamonds on the probability of state repression, using the average case approach and holding all other variables at their modes or means, which were 0 for all of the other binary indicators. This figure shows that the presence of diamonds does have a large, positive impact on the probability of state repression. While the substantive increase in the probability of violence is rather small, this is likely due to the low probability of violence in the dataset in general, as shown above in Figure 5 of the descriptive statistics. Given this overall low probability of violence, this increase in its probability is still substantively meaningful. This ultimately provides support for the first hypothesis, as the presence of at least one of type of resource does increase the probability of repressive violence by a meaningful amount, relative to the overall probability of violence in the data. 

Due to the lack of significance at the $p=.05$ level for the petroleum dummy variable, this result does not fully support the second hypothesis. While the positive and significant effect of lootable diamonds on the probability of state repression is as predicted, the non-significant effect of petroleum on the probability of state repression is not. While this finding shows that the presence of lootable resources does increase the probability of state repression in the vicinity of those resources, which provides support for part of the theory, this failure to find a significant effect for non-lootable resources indicates that the mechanisms proposed in the theory may be more limited in their scope than initially assumed.  

```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=T}
#The dependent variable is a binary indicator of whether OSV occurred in a given cell-year. Other IVs are same as in the poisson model below. 

data <- read.csv("Apr2020revdata.csv")
data <- data[,-1] #remove row counter column

#influential points NOT dropped bc that's a test for Poisson

#model itself
ml <- glm(data = data, binviol ~ activeconflict + diamsec_y + petroleum_y +gcp_ppp +pop_gpw_sum +year, family = binomial(link = 'logit'))
#summary(ml) #note that petro remains insignificant even when you drop gcp_ppp from the model

##check for multicollinearity
VIF(ml)
#no multicollinearity per http://www.sthda.com/english/articles/39-regression-model-diagnostics/160-multicollinearity-essentials-and-vif-in-r/ and using vif(ml) returns identical values, which is unsurprising since VIF is a wrapper for vif

##check petro gcp correlation per Navin: -0.05895 so no correlation to worry about
cor1 <- biserial.cor(data$gcp_ppp, data$petroleum_y, use = c("complete.obs"), level = 1)
#check other potential correlations for thoroughness
cor2 <- biserial.cor(data$gcp_ppp, data$diamsec_y, use = c("complete.obs"), level = 1) #0.005

#alternative probit model: significance and signs are all the same
#p <- glm(data = data, binviol ~ activeconflict + diamsec_y + petroleum_y +gcp_ppp +pop_gpw_sum +year, family = binomial(link = 'probit'))


```

```{r, echo=FALSE, warning=FALSE, results='asis'}
#nice regression table
stargazer(ml, title="Logit Model 1 Regression Results", dep.var.labels = "Probability of Violence", covariate.labels = c("Active Conflict Dummy", "Lootable Diamond Dummy","Petroleum Dummy","Gross Cell Product","Cell Population", "Year","Constant"), header = FALSE, no.space=TRUE)

```

```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=F}
#Pred probs via avg case approach, but without CIs. Eval F'd since the simulations return practically identical point estimates:

#dataset with all other variables held at mode or mean, and diamonds absent/prsent
nd <- data.frame(activeconflict=0, diamsec_y=c(0, 1), petroleum_y=0, gcp_ppp=mean(data$gcp_ppp), pop_gpw_sum = mean(data$pop_gpw_sum), year=mean(data$year))

predict(ml, newdata = nd, type = 'response') #shows no diamonds has p of violence at 0.0003 while with diamonds has p of violence at 0.0007

#dataset with all other variables held at mode or mean, and petro absent/present--not stat sig anyway
nd2 <- data.frame(activeconflict=0, diamsec_y=0, petroleum_y=c(0, 1), gcp_ppp=mean(data$gcp_ppp), pop_gpw_sum = mean(data$pop_gpw_sum), year=mean(data$year))

predict(ml, newdata = nd2, type = 'response') #shows no petro has p of violence at 0.0003364549 while with petro has p of violence at 0.0003041556 

```

```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=T, fig.width=5,fig.height=3}
#Pred probs with CIs using simulation and avg case approach, for diamonds:


## number of simulations for predicted probabilities
set.seed(9000)
N_sim <- 1000

## extract beta hats and construct vcv from our first model
betas <- ml$coef
vcv <- vcov(ml)

## use the mvrnorm function with the betas, vcv, and # of simulations to simulate
## parameter estimates. will have 1,000 estimates of each beta
beta_sims <- mvrnorm(N_sim, betas, vcv)

## create a hypothetical independent variable as before:
#intercept is always 1 by default, as shown by model.matrix(ml)
hyp <- with(data, data.frame(intercept = 1, activeconflict=0, diamsec_y=c(0, 1), petroleum_y=0, gcp_ppp=mean(data$gcp_ppp), pop_gpw_sum = mean(data$pop_gpw_sum), year=mean(data$year)))

## create an empty matrix of values to fill with simulated predicted probabilities
pp_sims <- matrix(NA, nrow = N_sim, ncol = 2)
#Using a for() loop to fill wth simulated pred. probs
for(i in 1:N_sim) {
  
  pp_sims[i, ] <- arm::invlogit(as.matrix(hyp) %*% beta_sims[i, ])
  
}

#we could also do the above with less code:
pp_sims2 <- arm::invlogit(as.matrix(hyp) %*% t(beta_sims)) #we must use transpose of beta_sims bc above force it to be a vecctor and R then forces it to work, but R
                                                    #won't do that here

dim(pp_sims)
dim(pp_sims2)

all(t(pp_sims) == pp_sims2) #so you get the same answers either way


## CIs. For each obs we have a thousand CI obs, so we take the mean of those
pe <- apply(pp_sims, 2, mean)
lo <- apply(pp_sims, 2, quantile, prob = .025)
hi <- apply(pp_sims, 2, quantile, prob = .975)

sim_output <- data.frame(diamonds = hyp[, 3], pe, lo, hi)

#ggplot(sim_output, aes(x = diamonds, y = pe, ymin = lo, ymax = hi)) +
#  geom_ribbon(aes(fill = '95% Confidence Interval (Simulation)'), alpha = .5) +
#  geom_line(aes(color = 'Predicted Probability Over Presence of Diamonds'),
#            size = 1) +
#  labs(x = 'Diamonds', y = 'Probability of OSV') +
#  theme_bw() +
#  theme(legend.title = element_text(), legend.position = 'bottom',
#        panel.grid.minor.x = element_blank(),
#        panel.grid.minor.y = element_blank()) +
#  scale_fill_manual(values = 'steelblue3', name = '') +
#  scale_color_manual(values = 'black', name = '')

ggplot(sim_output, aes(x = as.factor(diamonds), y = pe)) + 
  geom_point() + 
  geom_errorbar(aes(x=as.factor(diamonds),ymax = hi, ymin = lo), width=.1) +
  labs(title = "Figure 8: Predicted Probability of State Violence \n using Average Case Approach, with 95% CIs", x = "Values of Diamond Indicator", y = "Probability of One-Sided State Violence") +
  theme_bw() + 
  theme(axis.title=element_text(size=8))

```

```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, fig.width=5,fig.height=3, eval=F}
#Pred probs with CIs using simulation and avg case approach, for oil. Eval F'd since oil not stat sig


## number of simulations for predicted probabilities
set.seed(9000)
N_sim <- 1000

## extract beta hats and construct vcv from our first model
betas <- ml$coef
vcv <- vcov(ml)

## use the mvrnorm function with the betas, vcv, and # of simulations to simulate
## parameter estimates. will have 1,000 estimates of each beta
beta_sims <- mvrnorm(N_sim, betas, vcv)

## create a hypothetical independent variable as before:
hyp <- with(data, data.frame(intercept = 1, activeconflict=0, diamsec_y=0, petroleum_y=c(0, 1), gcp_ppp=mean(data$gcp_ppp), pop_gpw_sum = mean(data$pop_gpw_sum), year=mean(data$year)))

#We could also have done this using model.matrix()

## create an empty matrix of values to fill with simulated predicted probabilities
pp_sims <- matrix(NA, nrow = N_sim, ncol = 2)
#Using a for() loop to fill wth simulated pred. probs
for(i in 1:N_sim) {
  
  pp_sims[i, ] <- arm::invlogit(as.matrix(hyp) %*% beta_sims[i, ])
  
}

#we could also do the above with less code:
pp_sims2 <- arm::invlogit(as.matrix(hyp) %*% t(beta_sims)) #we must use transpose of beta_sims bc above force it to be a vecctor and R then forces it to work, but R
                                                    #won't do that here

dim(pp_sims)
dim(pp_sims2)

all(t(pp_sims) == pp_sims2) #so you get the same answers either way


## CIs. For each obs we have a thousand CI obs, so we take the mean of those
pe <- apply(pp_sims, 2, mean)
lo <- apply(pp_sims, 2, quantile, prob = .025)
hi <- apply(pp_sims, 2, quantile, prob = .975)

sim_output <- data.frame(diamonds = hyp[, 4], pe, lo, hi)

#ggplot(sim_output, aes(x = diamonds, y = pe, ymin = lo, ymax = hi)) +
#  geom_ribbon(aes(fill = '95% Confidence Interval (Simulation)'), alpha = .5) +
#  geom_line(aes(color = 'Predicted Probability Over Presence of Diamonds'),
#            size = 1) +
#  labs(x = 'Diamonds', y = 'Probability of OSV') +
#  theme_bw() +
#  theme(legend.title = element_text(), legend.position = 'bottom',
#        panel.grid.minor.x = element_blank(),
#        panel.grid.minor.y = element_blank()) +
#  scale_fill_manual(values = 'steelblue3', name = '') +
#  scale_color_manual(values = 'black', name = '')

ggplot(sim_output, aes(x = diamonds, y = pe)) + 
  geom_point() + 
  geom_errorbar(aes(x=diamonds,ymax = hi, ymin = lo)) +
  labs(title = "Predicted Probability of OSV using Average Case Approach, with 95% CIs", x = "Values of Petroleum Indicator", y = "Probability of OSV") +
  theme_bw()

```

# Discussion and Conclusion

These results provide some support for the theory. The logit model supported the first hypothesis, due to the strong positive effect of the presence of diamonds on the probability of state repression, but failed to fully support the second hypothesis. While the lack of more conclusive support for the theory is disappointing, there are some theoretical and methodological criticisms to consider before coming to a final verdict on this design. The first is the question of whether a standard logit model is actually the best model for the count data used to test the second hypothesis. The small absolute probabilities, due to the high number of zeros in the data, raise the question of whether a variant that accounts for those zeros is called for, such as a zero-inflated logit. A second potential criticism, and one that cannot be fixed by changes to the model itself, is that the unit of analysis may not be fine enough to pick up on the effects of resources. Given that PRIO-GRID cells are approximately 55 by 55 kilometers, these cells may simply be too large an area, leading to a failure to detect the true directions or significance of effects. A third potential criticism, this time focusing on the data, is the need to expand the range and coverage of the resource data, as the PRIO resource data only covers onshore petroleum deposits discovered through 2003 [@TRL7] and diamond deposits discovered to 2005 [@Gilmorecode], and the PRIO-GRID resource coding draws from those two datasets. Ideally, future analyses could also incorporate more than just these two archetypal resources. 

In spite of these issues, this analysis can still serve as a useful starting point for future research. One way in which it can do this is by motivating further refinement of the theory, to account for these findings. The lack of significance for the petroleum indicator in the logit model, despite the strong significance for the diamonds indicator, may indicate that different mechanisms are operating for petroleum resources than for diamond resources—more generally, that resources requiring external investment differ in some meaningful way from those that do not. While these precise mechanisms are unclear, future investigations could test this theory for other types of resources, such as precious metals, to see if they return similar results. Another avenue of investigation could be the use of case studies to uncover refinements to the causal mechanisms.

This is not the only potential theoretical development to be suggested by these results. An alternative direction could involve the strategic decision-making process at the firm level. While firm preferences are not extensively theorized here, this may benefit from additional specification. One possibility for expansion involves examining whether firms have preferences over repression—how much do firms pay attention to state behavior, and what are the conditions under which they do so? Such an expanded theory could provide insights not only into the effects of state repression but also potentially into the investment decisions of multinational firms. This could also potentially lead to models of the strategic interactions of the state and multinational corporations. 

Regardless of these potential future developments, however, the partial support for the theory provides an encouraging sign that this research still contributes a novel meaningful relationship between some types of resources and state repression. These results suggest that, once both geography and the need for external investment are accounted for, only easily lootable resources increase the probability of repressive violence by the state. This indicates that the linkage of resources and state violence is conditional, in at least some cases, on the geographic locations of those resources and the absence of requirements for international investment to enable their extraction. In short, both geographic location and the potential need for international investment influence the probability of observing a linkage between resources and state repressive violence. This novel finding ultimately helps to advance knowledge of the relationship between resources and violence, while providing several potential starting points for future work.

\newpage

# Appendix

```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=T, fig.width=5,fig.height=3}
#Plot of avg deaths per year for cells with GED events, not excluding Rwandan Genocide:

fd2 <- data %>% group_by(binviol,year) %>% summarise(avg = mean(civdeaths))
fd2 <- fd2[-1:-20,]

ggplot(data = fd2, aes(x = year, y = avg)) + 
  geom_line() +
  geom_point() +
 # ggrepel::geom_text_repel(aes(label = avg), color = "black", size = 2.5, segment.color = "grey") +
  labs(title = "Figure 4.1: Average of Civilian Deaths Per Year", x = "Year", y = "Average Deaths", caption = "Note: This figure includes 1994 data.")+ 
  theme_bw() #make the plot background blank w/grid lines
```


```{r, echo = FALSE, warning=FALSE, results='hide',message=FALSE, eval=F}
data <- read.csv("Apr2020revdata.csv")
data <- data[,-1] #remove row counter column

#fitting basic poisson
#returns warnings if includes gcp_ppp and pop_gpw_sum
#glm.fit: fitted rates numerically 0 occurred
#algorithm did not converge
#m0 <- glm(data = data, civdeaths ~ activeconflict+ binviol + diamsec_y + petroleum_y +gcp_ppp +pop_gpw_sum, family="poisson")
#summary(m0)

#increasing max iterations (since R uses iterative re-weighted least squares algorithm) to 100 from the baseline 25 is necessary to prevent "algorithm did not converge" error.
#however, it still returns glm.fit: fitted rates numerically 0 occurred, which likely indicates I have a predictor that perfectly predicts my response
m1 <- glm(data = data, civdeaths ~ activeconflict+ binviol + diamsec_y + petroleum_y +gcp_ppp +pop_gpw_sum +year, family="poisson", control = list(maxit = 100))
summary(m1)

#fitting neg binom--code left for future ref
#m2 <- glm.nb(civdeaths ~ activeconflict + binviol + diamsec_y + petroleum_y, data = data) 
#does not run if gcp_ppp + pop_gpw_sum are included
#summary(m2)
```

```{r, echo=FALSE, warning=FALSE, results='asis',eval=F}
#nice regression table
stargazer(m1, title="Original Poisson Regression Results", dep.var.labels = "Count of Civilian Deaths", covariate.labels = c("Active Conflict Dummy", "Binary Violence Dummy", "Lootable Diamond Dummy","Petroleum Dummy","Gross Cell Product","Cell Population", "Year","Constant"), header = FALSE, no.space=TRUE,notes = "Model run on data before influential points were dropped.")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, eval=F}
## Diagnostics on m1

#Overdispersion test, followed by plot of influential points showing four influential points (determined by Cook's Distance):


# code from https://stats.stackexchange.com/questions/70558/diagnostic-plots-for-count-regression

# Check for overdispersion--it's not, which advises against neg binom model and zero-inflated poisson
dispersiontest(m1) #not overdispersed (overdisp requirese p<.05)
dispersiontest(m2) #not overdispersed (overdisp requirese p<.05)

# Check for influential points--there are 4, since Cook's Dist is much greater than 4/n
influencePlot(m1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.align="left", eval=F}
#Plot of residuals against predicted values

# Residuals plotted 
res <- residuals(m1, type="deviance")
plot(predict(m1, type = "link"), res) #plotted against predicted values
#qqnorm(res) #qqplot

#to check goodness of fit, per https://stats.idre.ucla.edu/r/dae/poisson-regression/
with(m1, cbind(res.deviance = deviance, df = df.residual, p = pchisq(deviance, df.residual, lower.tail=FALSE)))

#all of this implies running a zero-inflated Poisson
#mod2 <- zeroinfl(civdeaths ~ activeconflict+ binviol + diamsec_y + petroleum_y +gcp_ppp +pop_gpw_sum +year,                 data=data, dist="poisson")
#AIC(m1, mod2)

```

\newpage

# References